<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <title>Daftar — MABISA / SIGAP BRIDA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Registrasi akun MABISA — Makassar Bukti & Insentif Satu Aplikasi" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            mabisa: {
              50: '#fdf5f5',
              100: '#fae5e6',
              200: '#f3c7ca',
              300: '#e89aa0',
              400: '#d86872',
              500: '#b1333f',
              600: '#8f2633',
              700: '#6e1d28',
              800: '#4a151d',
              900: '#2e0e14'
            }
          },
          boxShadow: {
            soft: '0 18px 45px rgba(15,23,42,0.08)'
          },
          borderRadius: {
            '3xl': '1.75rem'
          }
        }
      }
    };
  </script>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="mx-auto max-w-3xl px-4 py-12">
    <header class="mb-8 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-2xl bg-mabisa-500 text-white shadow-soft">
          <span class="text-sm font-semibold tracking-tight">MB</span>
        </div>
        <div>
          <h1 class="text-lg font-semibold text-slate-900">Daftar Akun MABISA</h1>
          <p class="text-xs text-slate-500">Bergabung untuk mengelola bukti RT/RW & verifikasi insentif.</p>
        </div>
      </div>

      <a href="/" class="rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-mabisa-50/40">
        Kembali ke Publik
      </a>
    </header>

    <main class="rounded-2xl bg-white p-6 shadow-soft">
      <!-- Flash / status area (server should populate if needed) -->
      <div id="flash" class="mb-4 hidden rounded-md bg-emerald-50 px-4 py-3 text-sm text-emerald-700"></div>

      <!-- Validation errors area (server should populate if needed) -->
      <div id="errors" class="mb-4 hidden rounded-md border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-700">
        <p class="font-semibold">Terjadi kesalahan:</p>
        <ul id="errorsList" class="mt-1 list-disc pl-5"></ul>
      </div>

      <!-- NOTE: server must inject CSRF token input here when converting to Blade -->
      <!-- Example (Blade): @csrf -->
      <form id="registerForm" method="POST" action="/register" class="grid gap-4" novalidate>
        <!-- If using server-side CSRF, add a hidden input like:
             <input type="hidden" name="_token" value="CSRF_TOKEN_HERE"> -->
        <div class="grid gap-3 md:grid-cols-2">
          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">Nama Lengkap</span>
            <input
              type="text"
              name="name"
              id="name"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="Contoh: Andi Gigatera"
            />
          </label>

          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">NIK</span>
            <input
              type="text"
              name="nik"
              id="nik"
              inputmode="numeric"
              pattern="\d*"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="Contoh: 3201xxxxxxxxxxxx"
            />
            <p class="mt-1 text-[11px] text-slate-400">NIK digunakan sebagai identitas unik (jangan bagikan).</p>
          </label>
        </div>

        <div class="grid gap-3 md:grid-cols-2">
          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">Email</span>
            <input
              type="email"
              name="email"
              id="email"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="nama@domain.go.id atau pribadi"
            />
          </label>

          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">No. HP</span>
            <input
              type="tel"
              name="phone"
              id="phone"
              inputmode="tel"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="08xxxxxxxxxx"
            />
          </label>
        </div>

        <div class="grid gap-3 md:grid-cols-2">
          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">Unit / Dinas</span>
            <input
              type="text"
              name="unit"
              id="unit"
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="Contoh: BRIDA / Dinas Sosial / Lurah ..."
            />
            <p class="mt-1 text-[11px] text-slate-400">Kosongkan bila tidak ada (akan diverifikasi admin).</p>
          </label>

          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">Role</span>
            <select
              name="role"
              id="role"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
            >
              <option value="" hidden>— Pilih role —</option>
              <option value="rt">RT</option>
              <option value="rw">RW</option>
              <option value="lurah">Lurah</option>
              <option value="camat">Camat</option>
              <option value="opd">OPD / Dinas</option>
              <option value="admin">Admin Kota / BRIDA</option>
              <option value="pegawai">Pegawai</option>
            </select>
          </label>
        </div>

        <div class="grid gap-3 md:grid-cols-2">
          <label class="flex flex-col relative">
            <span class="mb-1 text-xs font-medium text-slate-600">Password</span>
            <input
              id="password"
              type="password"
              name="password"
              required
              minlength="8"
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 pr-10 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="Minimal 8 karakter"
            />
            <button type="button" id="togglePw" class="absolute right-2 top-9 text-[13px] text-slate-500">Tampilkan</button>
            <p class="mt-1 text-[11px] text-slate-400">Gunakan kombinasi huruf, angka, dan simbol untuk keamanan.</p>
          </label>

          <label class="flex flex-col">
            <span class="mb-1 text-xs font-medium text-slate-600">Konfirmasi Password</span>
            <input
              id="password_confirmation"
              type="password"
              name="password_confirmation"
              required
              minlength="8"
              class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-mabisa-200"
              placeholder="Ketik ulang password"
            />
          </label>
        </div>

        <div class="flex items-start gap-3">
          <input id="agree" name="agree" type="checkbox" class="mt-1 h-4 w-4 rounded border-slate-300 text-mabisa-500 focus:ring-mabisa-200" required />
          <label for="agree" class="text-sm text-slate-700">Saya menyetujui kebijakan penggunaan & privasi SIGAP BRIDA. (<a href="/privacy" class="text-mabisa-600 underline">lihat kebijakan</a>)</label>
        </div>

        <div class="flex items-center justify-between gap-3 pt-2">
          <a href="/login" class="text-sm text-slate-600 hover:underline">Sudah punya akun? Masuk</a>

          <button
            id="btnSubmit"
            type="submit"
            class="inline-flex items-center gap-2 rounded-full bg-mabisa-500 px-5 py-2 text-xs font-semibold text-white shadow-soft hover:bg-mabisa-600"
          >
            Daftar Sekarang
          </button>
        </div>
      </form>
    </main>

    <footer class="mt-6 text-center text-xs text-slate-500">
      © <span id="year"></span> MABISA — Bagian dari SIGAP BRIDA • Badan Riset dan Inovasi Daerah Kota Makassar
    </footer>
  </div>

  <script>
    // tahun otomatis
    document.getElementById('year').textContent = new Date().getFullYear();

    // toggle show password
    const toggle = document.getElementById('togglePw');
    const pw = document.getElementById('password');
    toggle?.addEventListener('click', () => {
      if (!pw) return;
      if (pw.type === 'password') {
        pw.type = 'text';
        toggle.textContent = 'Sembunyikan';
      } else {
        pw.type = 'password';
        toggle.textContent = 'Tampilkan';
      }
    });

    // simple client-side validation before submit
    const form = document.getElementById('registerForm');
    const errorsBox = document.getElementById('errors');
    const errorsList = document.getElementById('errorsList');
    const flash = document.getElementById('flash');

    form?.addEventListener('submit', (e) => {
      // clear previous
      errorsList.innerHTML = '';
      errorsBox.classList.add('hidden');
      flash.classList.add('hidden');

      const pass = document.getElementById('password');
      const passc = document.getElementById('password_confirmation');
      const nik = document.getElementById('nik');

      let clientErrors = [];

      if (pass && passc && pass.value !== passc.value) {
        clientErrors.push('Password dan konfirmasi tidak cocok.');
      }

      if (nik && nik.value && !/^\d{16}$/.test(nik.value)) {
        // add a warning, but let user decide
        const ok = confirm('NIK biasanya 16 digit. Lanjutkan dengan NIK ini?');
        if (!ok) {
          clientErrors.push('Periksa NIK. Harap masukkan NIK 16 digit atau koreksi.');
          nik.focus();
        }
      }

      // basic required checks (in case browser doesn't enforce)
      ['name','nik','email','phone','role','password','password_confirmation','agree'].forEach((key) => {
        const el = form.querySelector(`[name="${key}"]`);
        if (el && el.hasAttribute('required') && !el.value) {
          clientErrors.push(`${key} wajib diisi.`);
        }
      });

      if (clientErrors.length) {
        e.preventDefault();
        errorsList.innerHTML = clientErrors.map(err => `<li>${err}</li>`).join('');
        errorsBox.classList.remove('hidden');
        return;
      }

      // disable button to prevent double submit
      const btn = document.getElementById('btnSubmit');
      if (btn) {
        btn.disabled = true;
        btn.classList.add('opacity-70', 'cursor-not-allowed');
      }
    });

    // Example: function to show server-side flash (callable by server-rendered JS)
    function showFlash(message, type = 'success') {
      flash.textContent = message;
      flash.classList.remove('hidden');
      if (type === 'error') {
        flash.classList.remove('bg-emerald-50','text-emerald-700');
        flash.classList.add('bg-rose-50','text-rose-700');
      } else {
        flash.classList.remove('bg-rose-50','text-rose-700');
        flash.classList.add('bg-emerald-50','text-emerald-700');
      }
    }
  </script>
</body>
</html>
